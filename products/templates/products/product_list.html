{% extends '_base.html' %}

{% load humanize %}

{% block page_title %}
لیست محصولات
{% endblock %}


{% block page_content %}

      <main class="flex-grow bg-background pb-14 pt-36 xs:pt-36">
        <div class="container relative">
          <!-- Mobile Options Section -->
          <div class="mb-6 flex items-center justify-center gap-x-4 md:hidden">
            <!-- Filter -->
            <button
              aria-controls="shop-filter-drawer-navigation"
              class="flex w-full items-center gap-x-4 rounded-lg bg-muted px-4 py-3 text-sm xs:text-base"
              data-drawer-show="shop-filter-drawer-navigation"
              data-drawer-placement="bottom"
              data-drawer-target="shop-filter-drawer-navigation"
              type="button"
            >
              <svg class="h-6 w-6">
                <use xlink:href="#filter" />
              </svg>
              <div>فیلتر</div>
            </button>
            <!-- Sort -->
            <button
              aria-controls="shop-sort-drawer-navigation"
              class="flex w-full items-center gap-x-4 rounded-lg bg-muted px-4 py-3 text-sm xs:text-base"
              data-drawer-show="shop-sort-drawer-navigation"
              data-drawer-placement="bottom"
              data-drawer-target="shop-sort-drawer-navigation"
              type="button"
            >
              <svg class="h-6 w-6">
                <use xlink:href="#sort" />
              </svg>
              <div>مرتب سازی</div>
            </button>
          </div>

          <div class="grid grid-cols-12 grid-rows-[60px_min(500px,_1fr)] gap-4">
            <!-- Desktop Filter Section -->
            <div class="col-span-4 row-span-2 hidden md:block lg:col-span-3">
              <div
                class="sticky top-32 mb-4 overflow-hidden rounded-lg bg-muted shadow-base"
              >
                <div
                  dir="ltr"
                  class="flex max-h-[calc(95vh_-_100px)] flex-col overflow-y-auto overflow-x-hidden px-4 py-3"
                >
<div dir="rtl" class="p-4 bg-white rounded-2xl shadow">
  <!-- Title -->
  <form id="filterForm" class="space-y-6">

  <div class="mb-6 flex items-center justify-between">
    <h3 class="text-lg font-semibold">فیلترها</h3>
<button type="button" id="resetFilters" class="text-sm text-red-500 hover:underline">
  حذف همه
</button>

<script>
  document.getElementById("resetFilters").addEventListener("click", () => {
    // فقط آدرس اصلی صفحه بدون پارامتر
    window.location.href = window.location.pathname;
  });
</script>
  </div>

    <!-- Price -->
    <div>
      <p class="mb-2 font-medium">محدوده قیمت (تومان)</p>
      <div class="flex items-center gap-2">
        <input
          type="number"
          name="min_price"
          value="{{ request.GET.min_price }}"
          placeholder="از"
          class="w-full rounded-lg border bg-gray-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-primary"
        />
        <span>-</span>
        <input
          type="number"
          name="max_price"
          value="{{ request.GET.max_price }}"
          placeholder="تا"
          class="w-full rounded-lg border bg-gray-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-primary"
        />
      </div>
    </div>

    <!-- Categories -->
    <div>
      <label for="categorySelect" class="mb-2 block font-medium">دسته‌بندی</label>
      <select
        id="categorySelect"
        name="category_slug"
        class="w-full rounded-lg border bg-gray-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-primary"
      >
        {% if request.GET.category_slug %}
        <option value="">{{ request.GET.category_slug }}</option>
        {% else %}
        <option value="">انتخاب دسته بندی</option>
        {% endif %}
        {% for category in parent_categories %}
        <option value="{{ category.slug }}">{{ category.name|truncatewords:5 }}</option>
        {% empty %}
        <option value="">دسته بندی ای یافت نشد</option>
        {% endfor %}
      </select>
    </div>

    <!-- Brands -->
    <div>
      <label for="brandSelect" class="mb-2 block font-medium">برند</label>
      <select
        id="brandSelect"
        name="brand_slug"
        class="w-full rounded-lg border bg-gray-50 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-primary"
      >
        {% if request.GET.brand_slug %}
        <option value="{{ brand.slug }}">{{ request.GET.brand_slug }}</option>
        {% else %}
        <option value="">انتخاب برند</option>
        {% endif %}
        {% for brand in brands %}
        <option value="{{ brand.slug }}">{{ brand.name }}</option>
        {% empty %}
        <option value="">برندی یافت نشد</option>
        {% endfor %}

      </select>
    </div>

    <!-- Toggles -->
    <div class="space-y-3">
      <label class="flex items-center justify-between cursor-pointer">
        <span>فقط کالاهای موجود</span>
        {% if request.GET.available %}
        <input type="checkbox" name="available" class="h-4 w-4" checked />
        {% else %}
        <input type="checkbox" name="available" class="h-4 w-4" />
        {% endif %}
      </label>
      <label class="flex items-center justify-between cursor-pointer">
        <span>فقط محصولات ویژه</span>
        {% if request.GET.special %}
        <input type="checkbox" name="special" class="h-4 w-4" checked />
        {% else %}
        <input type="checkbox" name="special" class="h-4 w-4" />
        {% endif %}
      </label>
    </div>

    <!-- Submit -->
    <div class="pt-4">
      <button
        type="submit"
        class="w-full rounded-lg bg-primary px-4 py-2 text-white hover:bg-primary/90"
      >
        اعمال فیلتر
      </button>
    </div>
  </form>
</div>

<script>
  // Reset filters
  document.getElementById("resetFilters").addEventListener("click", (e) => {
    e.preventDefault();
    document.getElementById("filterForm").reset();
  });
</script>
                </div>
              </div>
            </div>

            <div class="col-span-12 space-y-4 md:col-span-8 lg:col-span-9">
              <!-- Desktop Sort Section -->
              <div class="hidden md:block">
                <div
                  class="flex h-14 items-center gap-x-2 rounded-lg bg-muted px-2 text-text/90 shadow-base lg:px-4"
                >
                  <!-- Title -->
                  <div class="flex items-center gap-x-2 text-sm lg:text-base">
                    <svg class="h-6 w-6">
                      <use xlink:href="#sort" />
                    </svg>
                    <p>مرتب سازی بر اساس</p>
                  </div>
                  <!-- Sort Buttons -->
                  <a href="?sort_query=">
                  <button
                    class="{% if not request.GET.sort_query %} sort-button-active {% endif %} rounded-lg px-1 py-2 text-sm hover:bg-background hover: lg:px-4"
                  >
                    مشاهده همه
                  </button>
                    </a>
                  <a href="?sort_query=newest">
                  <button
                    class="{% if request.GET.sort_query == 'newest' %} sort-button-active {% endif %} rounded-lg px-1 py-2 text-sm hover:bg-background hover: lg:px-4"
                  >
                    جدید ترین
                  </button>
                    </a>
                  <a href="?sort_query=best-sell">
                  <button
                    class="{% if request.GET.sort_query == 'best-sell' %} sort-button-active {% endif %} rounded-lg px-1 py-2 text-sm hover:bg-background hover: lg:px-4"
                  >
                    پرفروش ترین
                  </button>
                    </a>
                  <a href="?sort_query=most-expensive">
                  <button
                    class="{% if request.GET.sort_query == 'most-expensive' %} sort-button-active {% endif %} rounded-lg px-1 py-2 text-sm hover:bg-background hover: lg:px-4"
                  >
                    گران ترین
                  </button>
                  </a>
                  <a href="?sort_query=cheapest">
                  <button
                    class="{% if request.GET.sort_query == 'cheapest' %} sort-button-active {% endif %} rounded-lg px-1 py-2 text-sm hover:bg-background hover: lg:px-4"
                  >
                    ارزان ترین
                  </button>
                  </a>
                </div>
              </div>

              <!-- Products Grid -->
              <div
                class="grid grid-cols-2 gap-px gap-y-2 xs:gap-4 sm:grid-cols-3 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"
              >
                <!-- Product Card -->
                {% for product in page_obj %}
                <div
                  class="border-gradient group relative rounded-base p-px before:absolute before:-inset-px before:h-[calc(100%+2px)] before:w-[calc(100%+2px)] before:rounded-base"
                >
                  <div
                    class="relative rounded-xl bg-muted p-2 shadow-base md:p-5"
                  >
                    <!-- image -->
                    <div class="mb-2 md:mb-5" draggable="false">
                      <a href='{{ product.get_absolute_url }}'>
                        <img
                          alt=""
                          class="mx-auto w-32 rounded-lg md:w-auto"
                          src="{{ product.main_image.url }}"
                        />
                      </a>
                    </div>
                    <!-- title -->
                    <div class="mb-1">
                      <a class='line-clamp-2 h-10 text-sm md:h-12 md:text-base' href='product-detail.html'>
                          {{ product.name }}
                      </a>
                    </div>
                    <!-- Prices -->
                    <div class="flex flex-col">
                      <!-- Old price -->
                      {% if product.has_valid_discount %}
                      <div class="h-5 text-left">
                        <del
                          class="text-xs text-text/60 decoration-warning xs:text-sm md:text-base"
                        >
                          {{ product.price|intcomma }}
                        </del>
                      </div>
                      <div class="flex items-center justify-between">
                        <div>
                          <p
                            class="w-7 rounded-full bg-warning py-px text-center text-xs text-white xs:w-9 xs:text-sm"
                          >
                            {{ product.discount.value|floatformat:0 }} %
                          </p>
                        </div>
                        <!-- New price -->
                        <div
                          class="text-xs font-bold text-primary xs:text-sm md:text-base"
                        >
                          {{ product.get_final_price|floatformat:0|intcomma }}
                          <span class="text-xs font-light md:text-sm"
                            >تومان</span
                          >
                        </div>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>
            <div
        aria-labelledby="shop-filter-drawer-navigation-label"
        class="fixed bottom-0 left-0 right-0 z-40 h-full w-full translate-y-full bg-muted transition-transform duration-300"
        id="shop-filter-drawer-navigation"
        tabindex="-1"
      >
        <div
          class="flex items-center justify-between gap-x-4 border-b p-4 pb-5"
        >
          <h5 class="text-lg text-text/90">فیلتر محصولات</h5>
          <button
            aria-controls="user-account-drawer-navigation"
            class="inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-text/90 hover:bg-zinc-100 hover:text-gray-900 dark:hover:bg-black dark:hover:text-white"
            data-drawer-hide="shop-filter-drawer-navigation"
            type="button"
          >
            <svg class="h-5 w-5">
              <use xlink:href="#close" />
            </svg>

            <span class="sr-only">Close menu</span>
          </button>
        </div>
              <div class="space-y-6 p-4">
  <!-- Search -->
  <div>
    <input
      type="text"
      placeholder="جستجو محصول..."
      class="w-full rounded-xl border bg-background px-3 py-2 text-sm shadow-sm focus:border-primary focus:ring-1 focus:ring-primary"
    />
  </div>

  <!-- Price -->
  <div>
    <label class="block mb-2 text-sm font-medium">محدوده قیمت (تومان)</label>
    <div class="flex items-center gap-2">
      <input
        type="number"
        placeholder="از"
        class="w-1/2 rounded-xl border px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary"
      />
      <input
        type="number"
        placeholder="تا"
        class="w-1/2 rounded-xl border px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary"
      />
    </div>
  </div>

  <!-- Categories -->
  <div>
    <label class="block mb-2 text-sm font-medium">دسته‌بندی</label>
    <select
      class="w-full rounded-xl border px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary"
    >
      {% if request.GET.category_slug %}
      <option>{{ request.GET.category_slug }}</option>
      {% else %}
      <option>همه</option>
      {% endif %}
      {% for category in parent_categories %}
      <option value="{{ category.slug }}">{{ category.name }}</option>
      {% empty %}
      <option>دسته بندی ای یافت نشد</option>
      {% endfor %}
    </select>
  </div>

  <!-- Brands -->
  <div>
    <label class="block mb-2 text-sm font-medium">برند</label>
    <select
      class="w-full rounded-xl border px-3 py-2 text-sm focus:border-primary focus:ring-1 focus:ring-primary"
    >
      {% if request.GET.brand_Slug %}
      <option>{{ request.GET.brand_slug }}</option>
      {% else %}
      <option>همه</option>
      {% endif %}
      {% for brand in brands %}
      <option value="{{ brand.slug }}">{{ brand.name }}</option>
      {% empty %}
      <option>برندی یافت نشد</option>
      {% endfor %}

    </select>
  </div>

  <!-- Toggles -->
  <div class="flex items-center justify-between">
    <label for="onlyAvailable" class="text-sm">فقط موجود</label>
    <input id="onlyAvailable" type="checkbox" class="h-4 w-4 rounded border-primary text-primary" />
  </div>

  <div class="flex items-center justify-between">
    <label for="onlySpecial" class="text-sm">فقط ویژه</label>
    <input id="onlySpecial" type="checkbox" class="h-4 w-4 rounded border-primary text-primary" />
  </div>

  <!-- Button -->
  <button class="btn-primary w-full rounded-xl py-3 text-sm font-medium">
    مشاهده نتایج
  </button>
</div>


        <!-- Footer -->

        <div
          class="sticky bottom-0 left-0 right-0 flex items-center justify-between border-t bg-muted p-4 px-6 py-4"
        >
          <button class="btn-primary w-full py-3 text-sm" type="button">
            مشاهده 200 محصول
          </button>
        </div>
      </div>


              <!-- Pagination -->
<div class="flex items-center justify-center gap-x-4 md:justify-end">
  <!-- Previous page-->
  {% if page_obj.has_previous %}
    <a
      class="pagination-button flex items-center justify-center"
      href="?page={{ page_obj.previous_page_number }}&{{ query_params.urlencode }}"
    >
      <svg class="h-6 w-6">
        <use xlink:href="#chevron-right"></use>
      </svg>
    </a>
  {% endif %}

  <!-- Pages -->
  <div class="flex items-center gap-x-2">
    {% for num in page_obj.paginator.page_range %}
      {% if page_obj.number == num %}
        <a class="pagination-button pagination-button-active" href="?page={{ num }}">
          {{ num }}
        </a>
      {% else %}
        <a class="pagination-button" href="?page={{ num }}">
          {{ num }}
        </a>
      {% endif %}
    {% endfor %}
  </div>

  <!-- Next page-->
  {% if page_obj.has_next %}
    <a
      class="flex h-8 w-8 items-center justify-center rounded-full bg-muted transition-all duration-200 hover:bg-primary hover:text-white hover:dark:bg-emerald-600"
      href="?page={{ page_obj.next_page_number }}&{{ query_params.urlencode }}"
    >
      <svg class="h-6 w-6">
        <use xlink:href="#chevron-left"></use>
      </svg>
    </a>
  {% endif %}
</div>

            </div>
          </div>
        </div>
      </main>
<div aria-labelledby="shop-sort-drawer-navigation-label"
     class="fixed bottom-0 left-0 right-0 z-40 h-auto w-full translate-y-full rounded-t-3xl bg-muted transition-transform duration-300"
     id="shop-sort-drawer-navigation"
     tabindex="-1">

  <div class="flex items-center justify-between gap-x-4 border-b p-4 pb-5">
    <h5 class="text-lg text-text/90">مرتب سازی بر اساس</h5>
    <button aria-controls="user-account-drawer-navigation"
            class="inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-text/90 hover:bg-zinc-100 hover:text-gray-900 dark:hover:bg-black dark:hover:text-white"
            data-drawer-hide="shop-sort-drawer-navigation"
            type="button">
      <svg class="h-5 w-5">
        <use xlink:href="#close" />
      </svg>
      <span class="sr-only">Close menu</span>
    </button>
  </div>

  <div class="main-scroll h-full space-y-2 divide-y overflow-y-auto p-4">
    <fieldset class="flex flex-col space-y-2">
      <legend class="sr-only">Sort</legend>
      <div>
        <input class="peer hidden"
               id="sort-all"
               name="sort"
               type="radio"
               value=""
               {% if not request.GET.sort_query %}checked{% endif %}>
        <label class="relative block w-full cursor-pointer rounded-lg border p-4 shadow-base peer-checked:border-emerald-500 peer-checked:dark:border-emerald-400"
               for="sort-all">
          <p class="text-center text-text/90">مشاهده همه</p>
        </label>
    </div>
      <div>
        <input class="peer hidden"
               id="sort-new"
               name="sort"
               type="radio"
               value="newest"
               {% if request.GET.sort_query == 'newest' %}checked{% endif %}>
        <label class="relative block w-full cursor-pointer rounded-lg border p-4 shadow-base peer-checked:border-emerald-500 peer-checked:dark:border-emerald-400"
               for="sort-new">
          <p class="text-center text-text/90">جدید ترین</p>
        </label>
      </div>

      <div>
        <input class="peer hidden"
               id="sort-sale"
               name="sort"
               type="radio"
               value="best_sell"
               {% if request.GET.sort_query == 'best_sell' %}checked{% endif %}>
        <label class="relative block w-full cursor-pointer rounded-lg border p-4 shadow-base peer-checked:border-emerald-500 peer-checked:dark:border-emerald-400"
               for="sort-sale">
          <p class="text-center text-text/90">پرفروش ترین</p>
        </label>
      </div>

      <div>
        <input class="peer hidden"
               id="sort-expensive"
               name="sort"
               type="radio"
               value="more_expensive"
               {% if request.GET.sort_query == 'more_expensive' %}checked{% endif %}>
        <label class="relative block w-full cursor-pointer rounded-lg border p-4 shadow-base peer-checked:border-emerald-500 peer-checked:dark:border-emerald-400"
               for="sort-expensive">
          <p class="text-center text-text/90">گران ترین</p>
        </label>
      </div>

      <div>
        <input class="peer hidden"
               id="sort-chip"
               name="sort"
               type="radio"
               value="cheapest"
               {% if request.GET.sort_query == 'cheapest' %}checked{% endif %}>
        <label class="relative block w-full cursor-pointer rounded-lg border p-4 shadow-base peer-checked:border-emerald-500 peer-checked:dark:border-emerald-400"
               for="sort-chip">
          <p class="text-center text-text/90">ارزان ترین</p>
        </label>
      </div>
    </fieldset>
  </div>
</div>
<script>
document.querySelectorAll('input[name="sort"]').forEach((radio) => {
    radio.addEventListener('change', function () {
        const url = new URL(window.location.href);
        url.searchParams.set('sort_query', this.value);
        window.location.href = url.toString();
    });
});
</script>

{% endblock %}
